#!/usr/bin/env bash
set -euo pipefail

# link-changelog prints a link to changelog for the package's version on
# https://pub.dev.
#
# It handles both simple git tags (starting with "v", e.g v0.2.5 or v4.2.0) and
# prefixed git tags (e.g "flutter_comms-v0.0.5" or "leancode_lint-v1.3.0").
#
# Usage:
#
# $ link-changelog <package_name> <git_tag>
#
# For example:
#
# $ link-changelog some_single_package v0.7.3
# 
# $ link-changelog leancode_contracts leancode_contracts-v2.1.0

package_name="${1:-}"
tag="${2:-}"

if [ -z "$package_name" ]; then
    echo "error: missing package name" 1>&2
    exit 1
fi

if [ -z "$tag" ]; then
    echo "error: missing tag" 1>&2
    exit 1
fi

prefix="${3:-${package_name}-}"
version="${tag#$prefix}"
version="${version#v}"
version=$(echo "$version" | tr -d '.+')
link="https://pub.dev/packages/$package_name/changelog#$version"
echo "$link"
