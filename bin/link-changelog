#!/usr/bin/env bash
set -euo pipefail

# link creates a link to changelog for the package's version on https://pub.dev.
#
# It assumes that the git tag starts with "v".

package_name="${1:-}"
tag="${2:-}"
prefix="${3:-}"

if [ -z "$package_name" ]; then
    echo "error: missing package name"
    exit 1

fi

if [ -z "$tag" ]; then
    echo "error: missing tag"
    exit 1
fi

if [ -n "$prefix" ]; then
    tag="${tag//$prefix/}"
fi

version=$(echo "${tag#v}" | tr -d '.+')
link="https://pub.dev/packages/$package_name/changelog#$version"
echo "$link"
